<!DOCTYPE html>

<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>لوحة تحكم الموظف - صالون لمسة إبداعية</title>
<style>
:root{
    --gold:#FFD700;
    --daily-bg:#2E2B2B;
    --monthly-bg:#1E3A5F;
    --panel-bg:#111;
    --card-text:#fff;
    --page-bg-top:#000;
    --page-bg-bottom:#111;
}
body {
    font-family:'Cairo',sans-serif;
    background: linear-gradient(180deg,var(--page-bg-top),var(--page-bg-bottom));
    color:#fff;
    margin:0; padding:20px;
}
header { text-align:center; margin-bottom:20px; }
header .logo-container { display:inline-block; border:4px solid var(--gold); border-radius:50%; padding:5px; box-shadow:0 0 20px var(--gold); margin-bottom:10px; }
header .logo-container img { width:80px; height:80px; border-radius:50%; object-fit:cover; }
header h1 { font-size:1.8rem; color:var(--gold); margin:0; text-shadow:0 0 10px var(--gold); }
#welcomeTxt { font-size:1rem; margin-top:8px; }

.cards-container { display:flex; gap:15px; flex-wrap:wrap; justify-content:center; margin-bottom:20px; }
.card { flex:1 1 200px; min-width:150px; padding:15px; border-radius:10px; text-align:center; color:var(--card-text); background:var(--daily-bg); border:1px solid rgba(255,215,0,0.1); box-shadow:0 0 12px rgba(255,215,0,0.1); }
.card.monthly { background:var(--monthly-bg); }
.card h3 { margin:0 0 5px; font-size:1rem; text-shadow:0 0 5px rgba(0,0,0,0.4); }
.card p { margin:0; font-size:1.2rem; font-weight:700; }

.filter-row, .salf-section { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-bottom:20px; }
.filter-row input, .salf-section input { padding:8px; border-radius:6px; border:none; background:var(--panel-bg); color:#fff; text-align:right; min-width:120px; flex:1 1 140px; }
.filter-row button, .salf-section button { padding:8px 12px; border-radius:6px; border:none; background:var(--gold); color:#111; font-weight:bold; cursor:pointer; flex:1; min-width:100px; transition:0.3s; }
.filter-row button:hover, .salf-section button:hover { transform:translateY(-2px); box-shadow:0 0 15px var(--gold); }

.sales-tables {
display: flex;
gap: 2%;
justify-content: center;
flex-wrap: nowrap;
margin-bottom: 20px;
}
.sales-tables table {
border-collapse: collapse;
width: 49%;
text-align: center;
}
.sales-tables th, .sales-tables td {
padding: 6px;
border: 1px solid #444;
}
.sales-tables th { background:#333; color: var(--gold); }
.sales-tables td { background: #222; }
.sales-tables td.total { color: var(--gold); font-weight: bold; }

@media(max-width:350px){
.sales-tables table {
width: 48%;
font-size: 0.65rem;
padding: 2px;
}
.sales-tables th, .sales-tables td { padding: 3px; }
}

.table-section { width:100%; display:block; }
.table-wrap { width:100%; overflow-x:auto; margin-bottom:20px; }
table.general { width:100%; border-collapse:collapse; table-layout: fixed; background:#222; border-radius:8px; overflow:hidden; }
table.general th, table.general td { padding:8px; text-align:center; border-bottom:1px solid #444; word-wrap: break-word; }
table.general th { background:#333; color:var(--gold); }
.warning { color:#ffcc00; margin-top:8px; font-size:0.95rem; }

@media(max-width:992px){
.card{ flex:1 1 150px; min-width:120px; }
.filter-row input, .filter-row button, .salf-section input, .salf-section button{ font-size:0.9rem; padding:6px; }
table.general th, table.general td{ font-size:0.9rem; padding:6px; }
}

@media(max-width:768px){
.cards-container{ flex-direction:column; gap:12px; }
.card{ min-width:100%; }
}

@media(max-width:480px){
.card{ min-width:80px; min-height:90px; font-size:0.8rem; }
.filter-row input, .filter-row button, .salf-section input, .salf-section button{ flex:1 1 45%; }
} </style>

</head>
<body>

<header>
    <div class="logo-container"><img src="logo.jpg" alt="Logo"></div>
    <h1>لوحة تحكم الموظف</h1>
    <p id="welcomeTxt"></p>
</header>

<div class="filter-row">
    <input type="date" id="startDate" placeholder="من">
    <input type="date" id="endDate" placeholder="إلى">
    <button onclick="applyFilter()">تطبيق الفلتر</button>
    <button onclick="resetFilter()">إعادة الضبط</button>
    <button onclick="backToSales()">رجوع</button>
</div>

<div class="salf-section">
    <input type="number" id="salfAmount" placeholder="المبلغ">
    <button onclick="addSalf()">تسجيل السلفة</button>
</div>

<div class="sales-tables">
    <table id="dailyTable">
        <thead><tr><th colspan="2">المبيعات اليومية</th></tr></thead>
        <tbody>
            <tr><td>كاش</td><td id="cashToday">0</td></tr>
            <tr><td>شبكة</td><td id="cardToday">0</td></tr>
            <tr><td>توتال</td><td id="totalToday">0</td></tr>
        </tbody>
    </table>

```
<table id="monthlyTable">
    <thead><tr><th colspan="2">المبيعات الشهرية</th></tr></thead>
    <tbody>
        <tr><td>كاش</td><td id="cashMonth">0</td></tr>
        <tr><td>شبكة</td><td id="cardMonth">0</td></tr>
        <tr><td>توتال</td><td id="totalMonth">0</td></tr>
    </tbody>
</table>
```

</div>

<div class="table-section">
    <div class="table-wrap">
        <h2 style="text-align:center;">جدول عمليات البيع</h2>
        <table class="general">
            <thead>
                <tr><th>الموظف</th><th>المبلغ</th><th>طريقة الدفع</th><th>التاريخ</th><th>الوقت</th></tr>
            </thead>
            <tbody id="salesTable"></tbody>
        </table>
    </div>

```
<div class="table-wrap">
    <h2 style="text-align:center;">جدول السلف</h2>
    <table class="general">
        <thead>
            <tr><th>الموظف</th><th>المبلغ</th><th>التاريخ</th><th>الوقت</th></tr>
        </thead>
        <tbody id="salfTable"></tbody>
    </table>
</div>
```

</div>

<script>
let employeeName = (new URLSearchParams(window.location.search)).get('user') || localStorage.getItem('loggedEmployee') || 'عام';
document.getElementById('welcomeTxt').textContent = 'الموظف الحالي: ' + employeeName;

document.addEventListener('DOMContentLoaded', () => {
    loadCards();
    loadSalesTable();
    loadSalfTable();
});

function backToSales(){ window.location.href='employee_sales.html'; }
function toNumber(v){ let n=parseFloat(v); return isNaN(n)?0:n; }
function normalizeName(name){ return name?name.toString().trim().toLowerCase():''; }
function extractDateTime(record){
    let date=''; let time='';
    if(record.datetime){ const parts=record.datetime.split('T'); date=parts[0]; if(parts[1]) time=parts[1].split('.')[0]; }
    else{ date=record.date||''; if(record.time){ let t=record.time.toString(); if(t.includes("AM")||t.includes("PM")) time=t; else if(/^\d{2}:\d{2}$/.test(t)) time=t+":00"; else time=t; } }
    return {date,time};
}
function getEmployeeFromRecord(rec){ return (rec.employee||rec.user||rec.username||rec.staff||'').toString(); }

function loadCards(){
    let sales = JSON.parse(localStorage.getItem('salesData')||'[]');
    let cashToday=0, cardToday=0, totalToday=0, cashMonth=0, cardMonth=0, totalMonth=0;
    const todayStr = new Date().toISOString().slice(0,10);
    sales.forEach(s=>{
        const emp = getEmployeeFromRecord(s);
        if(normalizeName(emp)!==normalizeName(employeeName)) return;
        const amt=toNumber(s.amount||s.price||0);
        const method=(s.method||s.payment||s.type||'').toString().trim().toLowerCase();
        if(dt = extractDateTime(s), dt.date===todayStr){
            if(method==='كاش' || method==='cash') cashToday+=amt;
            else cardToday+=amt;
        }
        if(method==='كاش' || method==='cash') cashMonth+=amt;
        else cardMonth+=amt;
    });
    totalToday=cashToday+cardToday; totalMonth=cashMonth+cardMonth;
    document.getElementById('cashToday').textContent=cashToday.toFixed(2);
    document.getElementById('cardToday').textContent=cardToday.toFixed(2);
    document.getElementById('totalToday').textContent=totalToday.toFixed(2);
    document.getElementById('cashMonth').textContent=cashMonth.toFixed(2);
    document.getElementById('cardMonth').textContent=cardMonth.toFixed(2);
    document.getElementById('totalMonth').textContent=totalMonth.toFixed(2);
}

function loadSalesTable(filteredData=null){
    let sales = filteredData!==null?filteredData.slice():JSON.parse(localStorage.getItem('salesData')||'[]');
    sales = sales.filter(s=>employeeName?normalizeName(getEmployeeFromRecord(s))===normalizeName(employeeName):true);
    const table=document.getElementById('salesTable'); table.innerHTML='';
    sales.forEach(s=>{
        const emp=getEmployeeFromRecord(s)||'';
        const amt=toNumber(s.amount||s.price||0);
        const method=(s.method||s.payment||s.type||'').toString();
        const dt=extractDateTime(s);
        table.innerHTML+=`<tr><td>${emp}</td><td>${amt.toFixed(2)}</td><td>${method}</td><td>${dt.date}</td><td>${dt.time}</td></tr>`;
    });
}

function loadSalfTable(filteredData=null){
    let salfs = filteredData!==null?filteredData.slice():JSON.parse(localStorage.getItem('salfData')||'[]');
    salfs = salfs.filter(s=>employeeName?normalizeName(getEmployeeFromRecord(s))===normalizeName(employeeName):true);
    const table=document.getElementById('salfTable'); table.innerHTML='';
    salfs.forEach(s=>{
        const emp=getEmployeeFromRecord(s)||'';
        const amt=toNumber(s.amount||s.price||0);
        const dt=extractDateTime(s);
        table.innerHTML+=`<tr><td>${emp}</td><td>${amt.toFixed(2)}</td><td>${dt.date}</td><td>${dt.time}</td></tr>`;
    });
}

function applyFilter(){
    const start=document.getElementById('startDate').value;
    const end=document.getElementById('endDate').value;
    let sales=JSON.parse(localStorage.getItem('salesData')||'[]');
    let salfs=JSON.parse(localStorage.getItem('salfData')||'[]');
    if(start) sales=sales.filter(s=>extractDateTime(s).date>=start);
    if(end) sales=sales.filter(s=>extractDateTime(s).date<=end);
    if(start) salfs=salfs.filter(s=>extractDateTime(s).date>=start);
    if(end) salfs=salfs.filter(s=>extractDateTime(s).date<=end);
    loadSalesTable(sales);
    loadSalfTable(salfs);
    loadCards();
}

function resetFilter(){
    document.getElementById('startDate').value='';
    document.getElementById('endDate').value='';
    loadSalesTable();
    loadSalfTable();
    loadCards();
}

function addSalf(){
    const amount=parseFloat(document.getElementById('salfAmount').value);
    if(isNaN(amount)||amount<=0){ alert('أدخل مبلغ صالح'); return; }
    const salfs=JSON.parse(localStorage.getItem('salfData')||'[]');
    salfs.push({employee:employeeName,amount:amount,date:new Date().toISOString().slice(0,10),time:new Date().toLocaleTimeString()});
    localStorage.setItem('salfData',JSON.stringify(salfs));
    document.getElementById('salfAmount').value='';
    loadSalfTable();
}
</script>

</body>
</html>
